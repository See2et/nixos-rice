# NixOS + niri ライス改善タスク

## 目指す状態
- 機能が揃っているだけでなく、意図を感じるデスクトップにする。
- 見た目の一貫性、操作体験の気持ちよさ、保守しやすさを優先する。

## 前提ルール
- このファイルは提案用のバックログ（実装そのものは書かない）。
- 1つの関心事は1つのモジュール/ファイルが責務を持つ。
- ホスト境界を崩さない（desktop専用変更はdesktop配下で完結）。

## 優先度 0（まず構造的負債を解消）

### [x] T0-1: Waybarの責務を一本化する
- 背景: Waybar設定が実質的に複数箇所で定義され、差分の追跡と調整が難しい。
- 対象: `home/desktop/waybar.nix` と `home/desktop/default.nix` のどちらを正とするか決める。
- 完了条件:
  - Waybarのstyle/settingsを1つのモジュールだけが持つ。
  - もう片方は共通トークン参照に寄せるか、上書きをやめる。

### [x] T0-2: UIトークン層を作る
- 背景: いまの見た目は悪くないが、余白/角丸/不透明度/アクセントの基準が明文化されていない。
- 対象: 色、タイポグラフィスケール、角丸、余白、ぼかし/透明度を再利用可能なトークンとして定義する。
- 完了条件:
  - Bar、Launcher、通知、Lock/Power系が同じトークンを参照する。
  - トーン調整を1箇所の編集で反映できる。

## 優先度 1（体験のコアを整える）

### [x] T1-1: Lock + Idle の体験導線を設計する
- 背景: 手動ロックはあるが、自動アイドル時の挙動が体験上の大きな穴になっている。
- 対象: dim -> lock -> display off -> wake の流れを設計し、遷移を滑らかにする。
- 完了条件:
  - アイドル時の状態遷移が明確に定義されている。
  - ロック画面の見た目が全体の方向性と一致している。
- 設計メモ: 240sでdim -> 300sでlock -> 330sでdisplay off。入力復帰時は monitor on + 明るさ復元。

### [x] T1-2: 通知とOSD体験を仕上げる
- 背景: 通知は出るが、洗練されたライスに必要な視覚フィードバックの設計が足りない。
- 対象: 通知センターの見た目を定義し、音量/輝度OSDを一貫した挙動にする。
- 完了条件:
  - 通知スタイルが明示され、グローバルテーマと整合している。
  - OSDが後付け感なく、全体UXに溶け込んでいる。

### [x] T1-3: Launcher + Power Menu を統一する
- 背景: Launcher/Powerは高頻度操作なので、ここの質が完成度を大きく左右する。
- 対象: Rofi、Power menu、Lock動線の見た目と操作感を統一する。
- 完了条件:
  - LauncherとPower UIで共通の視覚言語が使われている。
  - キーボード中心の操作フローが明確で一貫している。

## 優先度 2（見た目のアイデンティティを確立）

### [x] T2-1: Cursor/Icon/GTK/Qtのテーマを統合する
- 背景: ダーク設定だけでは不十分で、ツールキット横断の統一が必要。
- 対象: GTKテーマ、アイコンテーマ、カーソルテーマ、Qtブリッジ方針を明示して揃える。
- 完了条件:
  - ツールキット間の目立つ違和感が残っていない。
  - カーソル/アイコンが主要アプリ全体で統一感を持つ。

### [ ] T2-2: 壁紙と配色の戦略を決める
- 背景: 単一壁紙の固定運用は可能だが、アートディレクションとしては拡張性が弱い。
- 対象: 壁紙ポリシー（厳選固定 or ローテーション）と配色調和ルールを定義する。
- 完了条件:
  - 壁紙とUI配色の関係が意図として文章化されている。
  - 壁紙を変えてもテーマ全体が破綻しない。

### [x] T2-3: niriのビジュアルルールを拡張する
- 背景: gaps/radius/focus ringは良い土台だが、個性としてはまだ弱い。
- 対象: 必要な範囲でアプリ別のwindow/layerルール（floating/opacity/border例外など）を増やす。
- 完了条件:
  - 主要アプリ種別に対するルールが明示されている。
  - 見た目の挙動が「たまたま」ではなく「意図的」になっている。

## 優先度 3（セッション品質と再現性）

### [x] T3-1: ログインからデスクトップ表示までを整える
- 背景: セッション開始直後の品質は、体感上の完成度に直結する。
- 対象: GDMからセッション開始までの見え方と起動順（壁紙、bar、通知）を定義する。
- 完了条件:
  - 起動シーケンスが安定し、視覚的に一貫している。
  - 通常ログイン時にフラッシュ/ちらつき/順序崩れがない。

### [ ] T3-2: ライス用QAチェックリストを作る
- 背景: 客観的な確認項目がないと、調整のたびに品質が後退しやすい。
- 対象: テーマ変更後に回せる軽量チェックリストを定義する。
- 完了条件:
  - タイポグラフィ、余白、コントラスト、操作遅延、ツールキット間整合を確認できる。
  - 少なくとも1つの「before/after」比較手順がある。

## 推奨着手順
1. T0-1 -> T0-2
2. T1-1 -> T1-2 -> T1-3
3. T2-1 -> T2-2 -> T2-3
4. T3-1 -> T3-2

## 現状メモ
- 土台はすでに強い（niriキー設定、壁紙導線、Waybarモジュール、Rofiテーマ、swaync有効化）。
- いまの最大ボトルネックはパッケージ不足ではなく、責務整理とデザイン一貫性。
- T1-3でLauncher/Power/Lock導線を `rofi-launcher` / `desktop-power-menu` / `desktop-session-action` に整理し、操作と見た目の統一基盤を作成。
- T2-3で`home/desktop/niri.nix`のwindow/layer rulesを拡張し、terminal・utility・communication・floatingレイヤーの見た目挙動を明示化。
